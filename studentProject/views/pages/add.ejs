<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Registration Form</title>
  <!-- ✅ Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .regForm {
      padding: 0px 80px 0px 80px;
      max-height: 600px;
    }

    .but {
      width: 50px;
    }
  </style>
</head>

<body class="container my-5 ">
  <%- include('../partials/header')%>
    <h2 class="text-center mb-4"><%- pageName==='add' ? 'Add' : 'Edit' %> Student</h2>

    <form class="row g-3 border p-4 rounded shadow regForm">
      <!-- First Name -->
      <div class="col-md-6">
        <label for="firstName" class="form-label">First Name</label>
        <input type="text" class="form-control" id="firstName" placeholder="Enter first name"
          value="<%=data.first_name %>" required>
      </div>

      <!-- Last Name -->
      <div class="col-md-6">
        <label for="lastName" class="form-label">Last Name</label>
        <input type="text" class="form-control" id="lastName" placeholder="Enter last name" value="<%=data.last_name %>"
          required>
      </div>

      <!-- Email -->
      <div class="col-md-6">
        <label for="email" class="form-label">Email</label>
        <input type="email" class="form-control" id="email" placeholder="example@gmail.com" value="<%=data.email %>"
          required>
      </div>

      <!-- Phone Number -->
      <div class="col-md-6">
        <label for="phone" class="form-label">Phone Number</label>
        <input type="tel" class="form-control" id="phone" placeholder="Enter phone number"
          value="<%=data.phone_number %>" required>
      </div>

      <!-- Date of Birth -->
      <div class="col-md-6">
        <label for="dob" class="form-label">Date of Birth</label>
        <input type="date" class="form-control" id="dob" placeholder="YYYY-MM-DD"
          value="<%= pageName === 'edit' ? new Date(data.date_of_birth).toISOString().split('T')[0] : ''%>" required>
      </div>

      <!-- Gender -->
      <div class="col-md-6">
        <label class="form-label">Gender</label>
        <select class="form-select" id="gender" required>
          <option value="">Choose...</option>
          <option value="Male" <%=data.gender==='Male' ? 'selected' : '' %>>Male</option>
          <option value="Female" <%=data.gender==='Female' ? 'selected' : '' %>>Female</option>
          <option value="Other" <%=data.gender==='Other' ? 'selected' : '' %>>Other</option>
        </select>
      </div>

      <!-- Department -->
      <div class="col-md-6">
        <label for="department" class="form-label">Department</label>
        <select class="form-select" id="department" required>
          <option value="">Choose...</option>
          <option value="Computer Science" <%=data.department==="Computer Science" ? 'selected' : '' %>>
            Computer Science </option>
          <option value="Information Technology" <%=data.department==="Information Technology" ? 'selected' : '' %>
            >Information Technology</option>
          <option value="Electronics and Communication" <%=data.department==="Electronics and Communication"
            ? 'selected' : '' %>>Electronics and Communication</option>
          <option value="Mechanical Engineering" <%=data.department==="Mechanical Engineering" ? 'selected' : '' %>
            >Mechanical Engineering</option>
          <option value="Civil Engineering" <%=data.department==="Civil Engineering" ? 'selected' : '' %>
            >Civil Engineering</option>
          <option value="Electrical Engineering" <%=data.department==="Electrical Engineering" ? 'selected' : '' %>
            >Electrical Engineering</option>
          <option value="Biotechnology" <%=data.department==="Biotechnology" ? 'selected' : '' %>
            >Biotechnology</option>
          <option value="Artificial Intelligence" <%=data.department==="Artificial Intelligence" ? 'selected' : '' %>
            >Artificial Intelligence</option>
          <option value="Data Science" <%=data.department==="Data Science" ? 'selected' : '' %>
            >Data Science</option>
          <option value="Business Administration" <%=data.department==="Business Administration" ? 'selected' : '' %>
            >Business Administration</option>

        </select>
      </div>

      <!-- Admission Date -->
      <div class="col-md-6">
        <label for="admissionDate" class="form-label">Admission Date</label>
        <input type="date" class="form-control" id="admissionDate" name="admission_date"
          value="<%= pageName === 'edit' ? new Date(data.admission_date).toISOString().split('T')[0] : '' %>" required>
      </div>

      <!-- City -->
      <div class="col-md-6">
        <label for="city" class="form-label">City</label>
        <input type="text" class="form-control" id="city" placeholder="Enter city" value="<%= data.city %>" required>
      </div>

      <!-- Submit Button -->
      <div class="d-flex flex-row gap-2 justify-content-center  ">

        <div class="col-12 text-center mt-4 w-auto">
          <button type="button" class="btn btn-primary px-4" onclick="back()">Back to list</button>
        </div>
        <div class="col-12 text-center mt-4 w-auto">
          <button type="button" class="btn btn-primary px-4" onclick="addStudent(event)">Submit</button>
        </div>
      </div>
    </form>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- ✅ FIXED SCRIPT -->
    <script>
      const pageName = "<%= pageName %>";
      const studentId = "<%= data.student_id || '' %>";
      let fname = document.getElementById('firstName')
      let lname = document.getElementById('lastName')
      let email = document.getElementById('email')
      let num = document.getElementById('phone')
      let dobDom = document.getElementById('dob')
      let genderDom = document.getElementById('gender')
      let dept = document.getElementById('department')
      let dateDom = document.getElementById('admissionDate')
      let cityDom = document.getElementById('city')


      function back() {
        window.location.href = "http://localhost:3000/student"
      }

      async function addStudent(event) {
        event.preventDefault()
        const department_id =
          dept.value === "Computer Science" ? 1 :
            dept.value === "Information Technology" ? 2 :
              dept.value === "Electronics and Communication" ? 3 :
                dept.value === "Mechanical Engineering" ? 4 :
                  dept.value === "Civil Engineering" ? 5 :
                    dept.value === "Electrical Engineering" ? 6 :
                      dept.value === "Biotechnology" ? 7 :
                        dept.value === "Artificial Intelligence" ? 8 :
                          dept.value === "Data Science" ? 9 :
                            dept.value === "Business Administration" ? 10 :
                              null;
        let data = {
          first_name: fname.value,
          last_name: lname.value,
          email: email.value,
          phone_number: num.value,
          date_of_birth: dobDom.value,
          gender: genderDom.value,
          department: dept.value,
          department_id: department_id,
          admission_date: dateDom.value,
          city: cityDom.value
        };
        const id = "<%= data.student_id %>"
        const myHeaders = new Headers();
        myHeaders.append("Content-Type", "application/json");
        const raw = JSON.stringify(data);
        const requestOptions = {
          method: pageName === 'edit' ? "PUT" : "POST",
          headers: myHeaders,
          body: raw,
        };
        const url = pageName === 'edit'
          ? `http://localhost:3000/api/student/${id}`
          : "http://localhost:3000/api/student"
        try {
          const response = await fetch(url, requestOptions)
          if (response.ok) {
            window.location.href = "http://localhost:3000/student"
          }
        }
        catch (error) {
          console.error(error)
          alter(error)
        };
      }
    </script>
</body>

</html>