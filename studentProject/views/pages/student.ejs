<!DOCTYPE html>
<html lang="en">

<head>
  <%- include('../partials/head') %>
    <style>
      .student-table {
        margin: 0px 80px 0px 80px;
        max-height: 400px;
        overflow-y: auto;
        overflow-x: auto;
        border: 1px solid #ccc;
      }

      .add {
        display: flex;
        justify-content: end;
        padding: 0px 36px 0px 36px;
      }

      .action {
        display: flex;
        gap: 2px;
      }

      .action>button {
        border: none;
        background-color: transparent;
        cursor: pointer;
      }

      .detail {
        color: black;
      }

      .detail:hover {
        text-decoration: blue;
      }
    </style>
</head>

<body class="main">
  <%- include('../partials/header') %>
    <div class="add">
      <a class="btn btn-primary " href="/student/add" role="button">Add</a>
    </div>
    <div class="student-table">
      <table class="table table-striped ">
        <thead>
          <tr scope="row">
            <th scope="col">Student Id</th>
            <th scope="col">First Name</th>
            <th scope="col">Last Name</th>
            <th scope="col">Name </th>
            <th scope="col">Email</th>
            <th scope="col">Phone Number</th>
            <th scope="col">Data of Birth</th>
            <th scope="col">Gender</th>
            <th scope="col">Department</th>
            <th scope="col">Addmission Date</th>
            <th scope="col">City</th>
            <th scope="col">Staff</th>
            <th scope="col">Action</th>
          </tr>
        </thead>
        <tbody>
          <%if(data.length===0){ %>
            <tr>
              <td colspan="13" class="text-center">No records</td>
            </tr>
            <%}else {%>
              <% data.forEach( Student=>{%>
                <tr>
                  <td>
                    <%=Student.student_id%>
                  </td>
                  <td>
                    <%=Student.first_name%>
                  </td>
                  <td>
                    <%=Student.last_name%>
                  </td>
                  <td>
                    <%=Student.first_name+ " " + Student.last_name%>
                  </td>
                  <td>
                    <%=Student.email%>
                  </td>
                  <td>
                    <%=Student.phone_number%>
                  </td>
                  <td>
                    <%= new Date(Student.date_of_birth).toLocaleDateString('en-IN')%>
                  </td>
                  <td>
                    <%=Student.gender%>
                  </td>
                  <td>
                    <%=Student.department_name%>
                  </td>
                  <td>
                    <%= new Date(Student.admission_date).toLocaleDateString('en-IN') %>
                  </td>
                  <td>
                    <%=Student.city%>
                  </td>
                  <td>
                    <a href="staff/detail/<%=Student.department_id%>" class="text-reset text-decoration-none detail">
                      <%=Student.staff_name%>
                    </a>
                  </td>
                  <td class="action">
                    <a href="student/edit/<%= Student.student_id %>" class="text-reset text-decoration-none"
                      style="text-decoration: none !important;">
                      ‚úèÔ∏è
                    </a>
                    <button onclick="deleteStudent(<%=Student.student_id%>)">üóëÔ∏è</button>
                  </td>

                </tr>
                <%})%>
                  <%}%>
        </tbody>
      </table>
   
    </div>
       <nav aria-label="Page navigation example">
        <ul class="pagination d-flex justify-content-center">
          <li class="<%= currentPage === 1 ? 'page-item disabled': 'page-item'%>"><a class="page-link" href="?page=<%= currentPage%>">Previous</a></li>
          <% for(let i=0;i < pageCount; i++){%>
          <li class="page-item">
            <a class="page-link" href="?page=<%= i + 1 %>">
              <%= i + 1 %>
            </a>
          </li>
          <%}%>      
          <li class="<%= currentPage === 1 ? 'page-item disabled': 'page-item'%>"><a class="page-link" href="?page=<%currentPage + 1%>">Next</a></li>
        </ul>
      </nav>
    <script>
      function deleteStudent(studentId) {
        const id = studentId
        const myHeaders = new Headers();
        myHeaders.append("Content-Type", "application/json");
        const requestOptions = {
          method: "DELETE",
          headers: myHeaders,
          redirect: "follow"
        };
        try {
          fetch(`http://localhost:3000/api/student/${id}`, requestOptions)
            .then(async (response) => {
              if (response.ok) {
                window.location.reload()
              }
              else {
                const error = await response.json()
                alert(error.message)
              }
            })
        }

        catch (error) {
          console.error(error)

        }
      }
    </script>
</body>

</html>